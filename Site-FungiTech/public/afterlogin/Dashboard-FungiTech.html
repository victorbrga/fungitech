<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Link para o CSS-->
    <link rel="stylesheet" href="../css/CSS-FungiTech.css">


    <!--Link para a fonte importada da Google-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <title>FungiTech | Dashboard</title>
</head>

<body class="dashboard" onload="verificar()">
    <!-- onload="ValidarSessao()" -->

    <!--Header-->
    <header class="header_dash">

        <div>
            <div> <!--Logo da Empresa-->
                <a href="HomePage-FungiTech.html"> <img class="logo" src="../img/LogoFungiTech3.png" alt="Logo FungiTech">
                </a>
            </div>

            <div class="link"> <!--Ir para página inicial-->
                <a href="Dashboard-FungiTech.html">Visão Geral</a>
            </div>

            <div class="link"> <!--Ir para Tela de Cadastro-->
                <a href="Dashboard(Media-Estufa1)-FungiTech.html">Média</a>
            </div>

            <div class="link"> <!--Ir para o simulador financeiro-->
                <a href="Dashboard(Alerta-Estufa1)-FungiTech.html">Alertas</a>
            </div>

            <div class="link"> <!--Ir para Tela de Cadastro-->
                <a href="HomePage-FungiTech.html">Sair</a>
            </div>

        </div>
    </header>



    <!-- Conteudo do Site -->
    <div class="tela">

        <div class="lateral" id="lateral"> <!-- Barra de alertas lateral -->

            <div class="tituloAlerta">
                <h1 style="text-align: center;"> Emergência <br> Nas Estufas !!</h1>
            </div>


            <div class="ultimoAlerta" id="ultimo"> <!-- Alerta -->
                <img src="../img/" alt="Alerta Vermelho">

                <a href="Dashboard(Alerta-Estufa1)-FungiTech.html" class="botaoAlerta">
                    <h4>Estufa 3</h4>
                </a>

                <div class="textoAlerta">
                    <p> Situação: </p>
                    <small> alertas</small>
                </div>
            </div>


            <div class="ultimoAlerta"> <!-- Alerta -->
                <img src="img/alertaVermelho.png" alt="Alerta Vermelho">

                <a href="Dashboard(Alerta-Estufa1)-FungiTech.html" class="botaoAlerta">
                    <h4>Estufa 4</h4>
                </a>

                <div class="textoAlerta">
                    <p> Situação: </p>
                    <small>6 alertas</small>
                </div>
            </div>


            <div class="ultimoAlerta"> <!-- Alerta -->
                <img src="img/alertaVermelho.png" alt="Alerta Vermelho">

                <a href="Dashboard(Alerta-Estufa1)-FungiTech.html" class="botaoAlerta">
                    <h4>Estufa 2</h4>
                </a>

                <div class="textoAlerta">
                    <p> Situação: </p>
                    <small>4 alertas</small>
                </div>
            </div>


            <div class="alerta"> <!-- Alerta -->
                <img src="img/alertaAmarelo.png" alt="Alerta Amarelo">

                <a href="Dashboard(Alerta-Estufa1)-FungiTech.html" class="botaoAlerta">
                    <h4>Estufa 5</h4>
                </a>

                <div class="textoAlerta">
                    <p> Situação: </p>
                    <small>1 alerta</small>
                </div>
            </div>

            <div class="alerta"> <!-- Alerta -->
                <img src="img/alertaAmarelo.png" alt="Alerta Amarelo">

                <a href="Dashboard(Alerta-Estufa1)-FungiTech.html" class="botaoAlerta">
                    <h4>Estufa 6</h4>
                </a>

                <div class="textoAlerta">
                    <p> Situação: </p>
                    <small>1 alerta</small>
                </div>
            </div>

        </div>




        <div class="principal"> <!-- Centro da Pagina -->

            <div class="tituloPrincipal">
                <br> <br>
                <h1> Confira suas estufas! </h1> <br>

                <div class="estufa">
<br> 
                    <div class="linha"> <!-- Linha de botões superior -->
                        <div class="card3" id="divCard1"> <!-- Botão Estufa -->
                            <h2> Estufa 1 - <br>
                                Tudo Certo! </h2>
                        </div>

                        <div class="card1" id="divCard2"> <!-- Botão Estufa -->
                            <h2> Estufa 2 - <br>
                                Em risco! </h2>
                        </div>

                        <div class="card1" id="divCard3"> <!-- Botão Estufa -->
                            <h2> Estufa 3 - <br>
                                Em risco! </h2>
                        </div>
                    </div>

                    <br> <br> <br>

                    <div class="linha"> <!-- Linha de botões inferior -->
                        <div class="card1" id="divCard4"> <!-- Botão Estufa -->
                            <h2> Estufa 4 - <br>
                                Em risco! </h2>
                        </div>

                        <div class="card2" id="divCard5"> <!-- Botão Estufa -->
                            <h2> Estufa 5 - <br>
                                Em Estado de alerta! </h2>
                        </div>

                        <div class="card2" id="divCard6"> <!-- Botão Estufa -->
                            <h2> Estufa 6 - <br>
                                Em Estado de alerta! </h2>
                        </div>
                    </div>

                </div>

            </div>

        </div>

    </div>



    <!--Footer-->
    <footer>
        <div class="dash_footer">
            <p> © Copyright FungiTech - 2024. Todos os direitos reservados</p>
        </div>
    </footer>

</body>

</html>

<script src="../js/sessao.js"></script>
<script>


    var cpfUsuario = sessionStorage.getItem("CPF");

    // Botão 1
    var card1 = document.getElementById('divCard1'); // Transforma o id do botão (card) em váriavel
    card1.addEventListener('click', function () { // Cria uma função ao clicar no item da váriavel 
        window.location.href = 'Dashboard(Media-Estufa1)-FungiTech.html'; // Mudar de página
    });



    // Botão 2
    var card1 = document.getElementById('divCard2'); // Transforma o id do botão (card) em váriavel
    card1.addEventListener('click', function () { // Cria uma função ao clicar no item da váriavel 
        window.location.href = 'Dashboard(Media-Estufa1)-FungiTech.html'; // Mudar de página
    });



    // Botão 3
    var card1 = document.getElementById('divCard3'); // Transforma o id do botão (card) em váriavel
    card1.addEventListener('click', function () { // Cria uma função ao clicar no item da váriavel 
        window.location.href = 'Dashboard(Media-Estufa1)-FungiTech.html'; // Mudar de página
    });



    // Botão 4
    var card1 = document.getElementById('divCard4'); // Transforma o id do botão (card) em váriavel
    card1.addEventListener('click', function () { // Cria uma função ao clicar no item da váriavel 
        window.location.href = 'Dashboard(Media-Estufa1)-FungiTech.html'; // Mudar de página
    });



    // Botão 5
    var card1 = document.getElementById('divCard5'); // Transforma o id do botão (card) em váriavel
    card1.addEventListener('click', function () { // Cria uma função ao clicar no item da váriavel 
        window.location.href = 'Dashboard(Media-Estufa1)-FungiTech.html'; // Mudar de página
    });



    // Botão 6
    var card1 = document.getElementById('divCard6'); // Transforma o id do botão (card) em váriavel
    card1.addEventListener('click', function () { // Cria uma função ao clicar no item da váriavel 
        window.location.href = 'Dashboard(Media-Estufa1)-FungiTech.html'; // Mudar de página
    });


    function verificar(){
        console.log(cpfUsuario + 'estou na dash')
        fetch("/alerta/verificar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                cpfUsuarioServer : cpfUsuario
            })
        }).then(resposta => {
            if (resposta.status == 200){
                resposta.json().then(resposta => {

                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    var tamanho_estufas = ((json.resultado_verificar_alertas).estufa).length;

                    for (contagem = 0 ; contagem < tamanho_estufas ; contagem++){
                    var estufa = (json.resultado_verificar_alertas[contagem]).estufa;
                    var alerta = (json.resultado_verificar_alertas[contagem]).alerta;
                    var img = ``

                    if(alerta >= 5){
                        img = `../img/alertaVermelho.png`
                    } else if (alerta >= 2){
                        img = `../img/alertaAmarelo.png`
                    } else {
                        img = `../img/alertaVerde.png`
                    }

                    lateral.innerHTML += `<div class="alerta">
                <img src="${img}">

                <a href="Dashboard(Alerta-Estufa1)-FungiTech.html" class="botaoAlerta">
                    <h4>${estufa}</h4>
                </a>

                <div class="textoAlerta">
                    <p> Situação: </p>
                    <small>${alerta} alerta</small>
                </div>
            </div>`
}
                });


            }
        });

        
    }
</script>
